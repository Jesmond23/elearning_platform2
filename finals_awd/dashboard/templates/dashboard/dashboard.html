{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Dashboard{% endblock %}
{% block content %}
<!-- Hero Section -->
<div class="bg-orange-50">
  <div class="max-w-7xl mx-auto px-4 py-7 flex items-center gap-6">

{% if user.profile_picture %}
<img
  src="{{ user.profile_picture.url }}"
  alt="Profile Picture"
  class="w-32 h-32 rounded-full object-cover border shadow"
/>
{% else %}
  <img
    src="{% static 'default-avatar.png' %}"
    alt="Default Avatar"
    class="w-36 h-36 rounded-full border shadow-sm object-cover"
  />
{% endif %}
    <div>

      <h2 class="text-3xl font-bold text-gray-800 mb-4">Welcome, {{user.username}}!</h2>
      <p class="mb-6 text-gray-600">This is your dashboard.</p>
    </div>
  </div>
</div>

<!-- Main Content Container - ALL content should be inside this -->
 <div class=" w-full py-6">
<div class="max-w-7xl mx-auto py-6 space-y-8 bg">
<div class="grid grid-cols-3 gap-6">
  <!--Left Column-->
  <div class="md:col-span-2 space-y-6">
    <!--Action buttons-->
     <div class="flex flex-wrap gap-3">
    {% if user.is_teacher %}
    <a href="{% url 'create_course' %}" class="inline-block bg-green-500 hover:bg-green-800 text-white text-md font-medium px-4 py-2 rounded-lg transition-colors">Create a Course</a>
    <a href="{% url 'browse_courses' %}" class="inline-block border border-orange-600 text-gray-800 bg-orange-200 hover:bg-orange-400 text-md font-medium px-4 py-2 rounded-lg transition-colors">Browse All Courses</a>
    {% elif user.is_student %}
    <a href="{% url 'course_list' %}" class="inline-block bg-blue-500 hover:bg-blue-800 text-white text-md font-medium px-4 py-2 rounded-lg transition-colors">Browse Courses</a>
    {% endif %}
  </div>

   <!-- Your Courses -->
      <div class="bg-cyan-50 hover:shadow-xl transition-shadow duration-300 shadow-md rounded-xl p-6">
        <h4 class="text-2xl font-semibold text-gray-700 mb-4">Your Courses</h4>
        <ul class="space-y-4">
          {% for course in courses %}
         <li>
  <a href="{% url 'course_detail' course.id %}" class="flex items-center gap-4 hover:bg-yellow-100 p-2 rounded transition">
    {% if course.image %}
      <img src="{{ course.image.url }}" alt="{{ course.title }}" class="w-16 h-16 object-cover rounded-md shadow-sm border" />
    {% else %}
      <div class="w-16 h-16 bg-gray-200 rounded-md flex items-center justify-center text-gray-400 text-sm border">No Image</div>
    {% endif %}
    <span class="text-lg font-medium text-gray-800">{{ course.title }}</span>
  </a>
</li>
          {% empty %}
            <li class="text-gray-500">No courses yet.</li>
          {% endfor %}
        </ul>
      </div>

  <!--Post update-->
  <!-- Post a Status Update -->
<div class="bg-blue-50 border-l-4 border-b-4 border-blue-200 hover:shadow-xl transition-shadow duration-300 shadow-md rounded-xl p-6">
  <h4 class="text-2xl font-semibold text-gray-700 mb-4">Post an Update</h4>
  <form method="POST" class="space-y-4">
    {% csrf_token %}
    {{ form.content|add_class:"w-full px-2 py-1 border rounded resize-none" | attr:"rows:4" | attr:"placeholder:Write your update here" }}

    <button type="submit" name="status_submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 text-md rounded">
      Post
    </button>
  </form>
</div>
   <!-- Recent Status Updates -->
 <div class="bg-slate-100 ring-1 ring-blue-100 rounded-lg hover:shadow-xl transition-shadow duration-300 shadow-md p-4">
   <p class="text-2xl font-bold text-gray-800 p-3">Recent Status Updates</p>
  <div id="status-list">
  {% include 'dashboard/partials/status_list.html' with statuses=statuses %}
  </div>

  <div class="text-center mt-4">
    <button id="load-more-btn" class="text-blue-600 hover:underline text-sm">Load more updates</button>
  </div>
</div>
</div>


<!--Right column-->
<!--Right column-->
<aside class="col-span-1 space-y-6">
  <div class="bg-slate-100 border-l-4 border-b-4 border-blue-300 hover:shadow-xl transition-shadow duration-300 shadow-md rounded-xl p-6">
    <h4 class="text-2xl font-semibold text-gray-700 mb-4">Course Materials</h4>
    {% for course in courses %}
      <div class="mb-6">
        <h5 class="text-lg font-medium text-gray-800 mb-2">{{ course.title }}</h5>
        <ul class="space-y-2">
          {% for mat in course.materials.all %}
            <li class="flex items-center gap-2">
              {% if ".jpg" in mat.file.url or ".png" in mat.file.url %}
                <img src="{{ mat.file.url }}" alt="{{ mat.title }}" class="w-8 h-8 rounded-md object-cover" />
              {% elif ".pdf" in mat.file.url %}
                <span class="text-red-600">üìÑ</span>
              {% else %}
                <span class="text-gray-600">üìÅ</span>
              {% endif %}
              <a href="{{ mat.file.url }}" target="_blank" class="text-md text-blue-600 hover:underline">{{ mat.title }}</a>
            </li>
          {% empty %}
            <li class="text-gray-400 text-md">No materials yet.</li>
          {% endfor %}
        </ul>
      </div>
    {% endfor %}
  </div>
</aside>
</div>

  </div>
</div>
</div>

<!--Script for AJAX status updates-->
<script>
  let offset=5;
  const btn = document.getElementById('load-more-btn');
  btn.addEventListener('click', function(){
    fetch(`/dashboard/status/load_more/?offset=${offset}`)
    .then(response=>response.json())
    .then(data=>{
      document.getElementById('status-list').insertAdjacentHTML('beforeend', data.html);
      offset +=5;
      if(!data.has_more){
        btn.style.display ='none';
      }
    });
  });

</script>

{% endblock %}
